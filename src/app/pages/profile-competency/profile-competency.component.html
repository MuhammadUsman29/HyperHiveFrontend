<app-header></app-header>

<div class="competency-container">
  <div class="competency-content">
    <!-- Header Section -->
    <div class="competency-header">
      <h1 class="page-title">Profile Competency</h1>
      <p class="page-subtitle">Your skills validation and competency assessment</p>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading your competency profile...</p>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="errorMessage && !isLoading">
      <div class="alert alert-error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ errorMessage }}
      </div>
    </div>

    <!-- Competency Content -->
    <div class="competency-grid" *ngIf="competencyData && !isLoading">
      <!-- Validation Score Card -->
      <div class="stat-card overall-card" *ngIf="competencyData && competencyData.validationScore !== undefined && competencyData.validationScore !== null">
        <h2 class="card-title">Validation Score</h2>
        <div class="overall-score">
          <div class="score-circle" [class]="'score-' + getScoreColor(competencyData.validationScore || 0)">
            <span class="score-value">{{ competencyData.validationScore }}</span>
            <span class="score-label">Score</span>
          </div>
        </div>
        <div class="score-breakdown">
          <div class="score-item" *ngIf="competencyData && competencyData.validationLevel">
            <span class="score-name">Validation Level</span>
            <span class="score-number" [class]="'score-' + getValidationLevelColor(competencyData.validationLevel || '')">
              {{ competencyData.validationLevel }}
            </span>
          </div>
          <div class="score-item" *ngIf="competencyData && competencyData.skillsComparison && competencyData.skillsComparison.matchPercentage !== undefined && competencyData.skillsComparison.matchPercentage !== null">
            <span class="score-name">Match Percentage</span>
            <span class="score-number" [class]="'score-' + getScoreColor(competencyData.skillsComparison.matchPercentage || 0)">
              {{ competencyData.skillsComparison.matchPercentage }}%
            </span>
          </div>
        </div>
      </div>

      <!-- GitHub Profile Card -->
      <div class="stat-card" *ngIf="competencyData && competencyData.gitHubProfile">
        <div class="card-header">
          <h3 class="card-title">GitHub Profile</h3>
          <span class="score-badge" *ngIf="competencyData.gitHubProfile && competencyData.gitHubProfile.username">{{ '@' + competencyData.gitHubProfile.username }}</span>
        </div>
        <div class="github-stats" *ngIf="competencyData && competencyData.gitHubProfile">
          <div class="stat-item" *ngIf="competencyData.gitHubProfile.publicRepos !== undefined">
            <span class="stat-label">Public Repos</span>
            <span class="stat-value">{{ competencyData.gitHubProfile.publicRepos }}</span>
          </div>
          <div class="stat-item" *ngIf="competencyData.gitHubProfile.followers !== undefined">
            <span class="stat-label">Followers</span>
            <span class="stat-value">{{ competencyData.gitHubProfile.followers }}</span>
          </div>
          <div class="stat-item" *ngIf="competencyData.gitHubProfile.following !== undefined">
            <span class="stat-label">Following</span>
            <span class="stat-value">{{ competencyData.gitHubProfile.following }}</span>
          </div>
          <div class="stat-item" *ngIf="competencyData.gitHubProfile.totalCommits !== undefined">
            <span class="stat-label">Total Commits</span>
            <span class="stat-value">{{ competencyData.gitHubProfile.totalCommits }}</span>
          </div>
          <div class="stat-item" *ngIf="competencyData.gitHubProfile.yearsActive !== undefined">
            <span class="stat-label">Years Active</span>
            <span class="stat-value">{{ competencyData.gitHubProfile.yearsActive }}</span>
          </div>
        </div>
        <p class="card-description" *ngIf="competencyData && competencyData.gitHubProfile && competencyData.gitHubProfile.bio">
          {{ competencyData.gitHubProfile.bio }}
        </p>
      </div>

      <!-- GitHub Developer Analysis Heatmap Card -->
      <div class="stat-card full-width heatmap-card" *ngIf="gitHubAnalysis">
        <div class="card-header">
          <h3 class="card-title">GitHub Developer Analysis</h3>
          <span class="score-badge">{{ gitHubAnalysis.totalCommits }} commits</span>
        </div>
        
        <!-- Summary Stats -->
        <div class="analysis-summary">
          <div class="summary-item">
            <span class="summary-label">Pull Requests</span>
            <span class="summary-value">{{ gitHubAnalysis.totalPullRequests }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Lines Added</span>
            <span class="summary-value success">+{{ gitHubAnalysis.totalLinesAdded }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Lines Deleted</span>
            <span class="summary-value error">-{{ gitHubAnalysis.totalLinesDeleted }}</span>
          </div>
        </div>

        <!-- Domain Areas Heatmap -->
        <div class="heatmap-section">
          <h4 class="section-title">Domain Expertise Heatmap</h4>
          <div class="heatmap-grid">
            <div class="heatmap-item" 
                 *ngFor="let area of getTopDomainAreas()"
                 [class]="getContributionLevel(area.percentage)">
              <div class="heatmap-label">{{ area.area }}</div>
              <div class="heatmap-value">{{ area.contributionCount }}</div>
              <div class="heatmap-percentage">{{ area.percentage.toFixed(1) }}%</div>
            </div>
          </div>
        </div>

        <!-- Technologies Heatmap -->
        <div class="heatmap-section">
          <h4 class="section-title">Technology Stack Heatmap</h4>
          <div class="heatmap-grid">
            <div class="heatmap-item"
                 *ngFor="let tech of getTopTechnologies()"
                 [class]="getContributionLevel(tech.percentage)">
              <div class="heatmap-label">{{ tech.technology }}</div>
              <div class="heatmap-value">{{ tech.usageCount }}</div>
              <div class="heatmap-percentage">{{ tech.percentage.toFixed(1) }}%</div>
            </div>
          </div>
        </div>

        <!-- Languages Breakdown -->
        <div class="languages-section">
          <h4 class="section-title">Programming Languages</h4>
          <div class="language-bars">
            <div class="language-bar-item" *ngFor="let lang of getTopLanguages()">
              <div class="language-info">
                <span class="language-name">{{ lang.language }}</span>
                <span class="language-percentage">{{ lang.percentage.toFixed(1) }}%</span>
              </div>
              <div class="language-progress-bar">
                <div class="language-progress-fill" [style.width.%]="lang.percentage"></div>
              </div>
              <div class="language-stats">
                <span>{{ lang.fileCount }} files</span>
                <span>{{ lang.linesOfCode }} lines</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Concepts -->
        <div class="concepts-section" *ngIf="gitHubAnalysis.concepts && gitHubAnalysis.concepts.length > 0">
          <h4 class="section-title">Software Concepts</h4>
          <div class="concept-tags">
            <div class="concept-tag" *ngFor="let concept of gitHubAnalysis.concepts">
              <span class="concept-name">{{ concept.concept }}</span>
              <span class="concept-count">{{ concept.occurrenceCount }}</span>
            </div>
          </div>
        </div>

        <p class="analysis-date" *ngIf="gitHubAnalysis.analysisDate">
          Analysis performed: {{ formatDate(gitHubAnalysis.analysisDate) }}
        </p>
      </div>

      <!-- Skills Comparison Card -->
      <div class="stat-card" *ngIf="competencyData && competencyData.skillsComparison">
        <div class="card-header">
          <h3 class="card-title">Skills Comparison</h3>
          <span class="score-badge" *ngIf="competencyData.skillsComparison && competencyData.skillsComparison.matchPercentage !== undefined" 
                [class]="'badge-' + getScoreColor(competencyData.skillsComparison.matchPercentage || 0)">
            {{ competencyData.skillsComparison.matchPercentage }}% Match
          </span>
        </div>
        <div class="skills-comparison">
          <div class="comparison-section" *ngIf="competencyData.skillsComparison && competencyData.skillsComparison.claimedSkills && competencyData.skillsComparison.claimedSkills.length > 0">
            <h4 class="section-title">Claimed Skills</h4>
            <div class="skill-tags">
              <span class="skill-tag claimed" *ngFor="let skill of competencyData.skillsComparison.claimedSkills">
                {{ skill }}
              </span>
            </div>
          </div>
          <div class="comparison-section" *ngIf="competencyData.skillsComparison && competencyData.skillsComparison.matchedSkills && competencyData.skillsComparison.matchedSkills.length > 0">
            <h4 class="section-title">Matched Skills</h4>
            <div class="skill-tags">
              <span class="skill-tag matched" *ngFor="let skill of competencyData.skillsComparison.matchedSkills">
                {{ skill }}
              </span>
            </div>
          </div>
          <div class="comparison-section" *ngIf="competencyData.skillsComparison && competencyData.skillsComparison.unverifiedSkills && competencyData.skillsComparison.unverifiedSkills.length > 0">
            <h4 class="section-title">Unverified Skills</h4>
            <div class="skill-tags">
              <span class="skill-tag unverified" *ngFor="let skill of competencyData.skillsComparison.unverifiedSkills">
                {{ skill }}
              </span>
            </div>
          </div>
          <div class="comparison-section" *ngIf="competencyData.skillsComparison && competencyData.skillsComparison.additionalGitHubSkills && competencyData.skillsComparison.additionalGitHubSkills.length > 0">
            <h4 class="section-title">Additional GitHub Skills</h4>
            <div class="skill-tags">
              <span class="skill-tag additional" *ngFor="let skill of competencyData.skillsComparison.additionalGitHubSkills">
                {{ skill }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Languages & Topics -->
      <div class="stat-card full-width" *ngIf="competencyData && competencyData.gitHubProfile">
        <h3 class="card-title">GitHub Activity</h3>
        <div class="github-activity">
          <div class="activity-section" *ngIf="competencyData.gitHubProfile && competencyData.gitHubProfile.topLanguages && competencyData.gitHubProfile.topLanguages.length > 0">
            <h4 class="section-title">Top Languages</h4>
            <div class="skill-tags">
              <span class="skill-tag language" *ngFor="let lang of competencyData.gitHubProfile.topLanguages">
                {{ lang }}
              </span>
            </div>
          </div>
          <div class="activity-section" *ngIf="competencyData.gitHubProfile && competencyData.gitHubProfile.topicInterests && competencyData.gitHubProfile.topicInterests.length > 0">
            <h4 class="section-title">Topic Interests</h4>
            <div class="skill-tags">
              <span class="skill-tag topic" *ngFor="let topic of competencyData.gitHubProfile.topicInterests">
                {{ topic }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Analysis -->
      <div class="stat-card full-width" *ngIf="competencyData && competencyData.aiAnalysis">
        <h3 class="card-title">AI Analysis</h3>
        <div class="ai-analysis">
          <p class="analysis-text">{{ competencyData.aiAnalysis }}</p>
          <div class="validated-info" *ngIf="competencyData.validatedAt">
            <span class="validated-label">Validated at:</span>
            <span class="validated-date">{{ formatDate(competencyData.validatedAt) }}</span>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="stat-card full-width" *ngIf="competencyData && competencyData.recommendations && competencyData.recommendations.length > 0">
        <h3 class="card-title">Recommendations</h3>
        <div class="recommendations-list">
          <div class="recommendation-item" *ngFor="let recommendation of competencyData.recommendations; let i = index">
            <div class="recommendation-number">{{ i + 1 }}</div>
            <div class="recommendation-text">{{ recommendation }}</div>
          </div>
        </div>
        <button class="btn btn-primary btn-recommendations" (click)="navigateToQuiz()">
          Generate Personalized Quiz
        </button>
      </div>
    </div>
  </div>
</div>

